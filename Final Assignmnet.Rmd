---
title: "Final Assignment Analysis: A multi-decade time series of kelp forest community structure at San Nicolas Islands, California"
author: "Elizabeth Martin, Marjorie Mednikova, Riplee Mercer"
date: "December 6, 2022"
output: pdf_document
---

## Introduction



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(dplyr)
```


## Pulling in Data

```{r data}
kelp <-read.csv("final_rawdata.csv",stringsAsFactors = TRUE)
unique(kelp$GENUS_SPECIES)
```


## Data Cleaning

```{r data cleaning}

## Removing Columns
kelp_cleaned <- kelp %>% 
                  select(-SAMPLE_DESC,
                         -BIOMAS)


## Renaming Columns
kelp_cleaned <- kelp_cleaned %>% 
                        rename(Abundance = ABUNDANCE, 
                               Species = `GENUS_SPECIES`,
                               Plot = PLOT,
                               Latitude = LATITUDE,
                               Longitude = LONGITUDE,
                               Day = DAY, 
                               Month = MONTH,
                               Year = YEAR) 

## Adding Date Column
kelp_cleaned['Date'] <- NA
kelp_cleaned$Date<-as.Date(with(kelp_cleaned,paste(Year,Month,Day,sep="-")),"%Y-%m-%d")


## Adding Phylum Column
phylum <- read.csv("phylum.csv", stringsAsFactors = TRUE)
kelp_cleaned <- left_join(kelp_cleaned, phylum, by="Species")



## Organizing Columns
kelp_cleaned = select(kelp_cleaned, Abundance, Phylum, Species, Plot, Latitude, Longitude, Date, Year, Month, Day)


head(kelp_cleaned)
```


## Graphing
Ideas: 
  - Sea urchin abundance before introduction of sea otters versus after             (Echinodermata Phylum)
  - Algae (red,brown,green) abundance before introduction of sea otter versus       after
  - Algae (red,brown,green) abundance before El Nino event versus directly after
  - Phylum abundance in spring versus fall over time
  - Just overall trend of dataset over time 

## Abundance of Echindoerms before and after re-introduction of sea otters
```{r Echinodermata before vs after sea otters}
## Subset by phylum
echinodermata_year <- kelp_cleaned %>% 
  select(Abundance, Phylum, Species, Year, Date) %>% 
  filter(Phylum == "Echinodermata") %>% 
  group_by(Year, Phylum) %>% 
  summarize(Mean_Abundance = mean(Abundance))

## Plotting
ggplot(data= echinodermata_year,
       aes(x= Year, y= Mean_Abundance,
           color= Phylum, by= Phylum)) +
  geom_point() + geom_line() +
  geom_vline(xintercept= 1987, color= 'black') + 
  labs(x= "Year", y= "Mean Annual Abundance")
```

## Abundance of Echinoderms effects by El Nino Events
```{r Echinodermata affected EL Nino}
## Subset by phylum
echinodermata_year <- kelp_cleaned %>% 
  select(Abundance, Phylum, Species, Year, Date) %>% 
  filter(Phylum == "Echinodermata") %>% 
  group_by(Year, Phylum) %>% 
  summarize(Mean_Abundance = mean(Abundance))

## Plotting
ggplot(data= echinodermata_year,
       aes(x= Year, y= Mean_Abundance,
           color= Phylum, by= Phylum)) +
  geom_point() + geom_line() +
  geom_vline(xintercept= 1983, color= 'black') + 
  geom_vline(xintercept= 1998, color= 'black') +
  labs(x= "Year", y= "Mean Annual Abundance")
```

## Kelp averages over time, by phylum #

```{r plot 3}
# Subsetting by algae: 
algae_year <- kelp_cleaned %>%
  select(Abundance, Year, Date, Species, Phylum) %>% 
  filter(Phylum == "Rhodophyta" | Phylum == "Chlorophyta" |
           Phylum == "Phaeophyta") %>% 
  group_by(Year, Phylum) %>%
  summarize(Mean_Abundance = mean(Abundance))


ggplot(data=algae_year, aes(x=Year, y=Mean_Abundance, 
                            color=Phylum, by=Phylum)) + 
  geom_point() + geom_line() +
  geom_vline(xintercept= 1987, color= 'red') + 
  scale_color_manual(values = c("mediumseagreen", "chocolate4", 
                                "red3")) +
  labs(x="Year", y="Mean Annual Abundance")
```

## El Nino Events effects on the three macroalgae phylums
```{r El Nino}
## Subset by algae
algae_El_Nino <- kelp_cleaned %>% 
  select(Abundance, Phylum, Species, Year, Date) %>% 
  filter(Phylum == "Rhodophyta" | 
         Phylum == "Chlorophyta" |
         Phylum == "Phaeophyta") %>% 
  group_by(Year, Phylum) %>% 
  summarize(Mean_Abundance = mean(Abundance))

## Plotting
ggplot(data= algae_El_Nino,
       aes(x= Year, y= Mean_Abundance,
           color= Phylum, by= Phylum)) +
  geom_point() + geom_line() +
  geom_vline(xintercept= 1983, color= 'black') + 
  geom_vline(xintercept= 1998, color= 'black') +
  scale_color_manual(values = c("mediumseagreen", "chocolate4", 
                                "red3")) +
  labs(x= "Year", y= "Mean Annual Abundance")
```
## Adding a Season column:

```{r Seasons}

# Phylum abundance by season (still in progress)
# Create function using if-else to determine season:

season <- function(Month){
  if(Month<=3 | Month>11){return("Winter")
    }else if (Month>=4 & Month<=6){return("Spring")
    }else if(Month>6 & Month<=9){return("Summer")
    }else {return("Fall")}}

kelp_cleaned$Season <- vector("character", length=nrow(kelp_cleaned))
for (i in 1:nrow(kelp_cleaned)){
  kelp_cleaned$Season[i]<- season(kelp_cleaned$Month[i])}

# Average abundance by phylum and season: 

phylum_seasons <- kelp_cleaned %>%
  select(Abundance, Year, Date, Species, Phylum, Season) %>% 
  group_by(Season, Phylum) %>%
  summarize(Mean_Abundance = mean(Abundance))

```
